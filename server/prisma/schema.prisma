generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String   @id @default(cuid())
  employeeId        String   @unique
  firstName         String
  lastName          String
  email             String   @unique
  password          String
  role              Role     @default(STAFF)
  department        String?
  building          String?
  hireDate          DateTime?
  active            Boolean  @default(true)
  phoneNumber       String?
  emergencyContact  String?
  emergencyPhone    String?
  
  // Manager relationships - staff can have multiple managers
  managedUsers      User[]   @relation("ManagerToStaff")
  managers          User[]   @relation("ManagerToStaff")
  
  // Principal relationship for faculty
  principalId       String?
  principal         User?    @relation("PrincipalToFaculty", fields: [principalId], references: [id])
  faculty           User[]   @relation("PrincipalToFaculty")
  
  // Time tracking
  timeCards         TimeCard[]
  timeOffRequests   TimeOffRequest[]
  
  // Notifications
  notifications     Notification[]
  
  // Audit fields
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  // Approved time off and time cards
  approvedTimeOff   TimeOffRequest[] @relation("ApprovedBy")
  approvedTimeCards TimeCard[] @relation("ApprovedBy")
  
  @@map("users")
}

enum Role {
  STAFF                // Submit timecards and time off
  MANAGER             // Approve staff timecards and time off
  FULL_TIME_FACULTY   // Submit time off only, no timecards
  PRINCIPAL           // Approve faculty time off, view building data
  DISTRICT_ADMIN      // Full system access
}

model TimeCard {
  id            String   @id @default(cuid())
  employeeId    String
  employee      User     @relation(fields: [employeeId], references: [id])
  
  periodStart   DateTime
  periodEnd     DateTime
  status        TimeCardStatus @default(DRAFT)
  totalHours    Float    @default(0)
  
  timeEntries   TimeEntry[]
  
  submittedAt   DateTime?
  approvedAt    DateTime?
  approvedBy    String?
  approver      User?    @relation("ApprovedBy", fields: [approvedBy], references: [id])
  comments      String?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@map("time_cards")
}

enum TimeCardStatus {
  DRAFT
  SUBMITTED
  APPROVED
  REJECTED
}

model TimeEntry {
  id          String   @id @default(cuid())
  timeCardId  String
  timeCard    TimeCard @relation(fields: [timeCardId], references: [id])
  
  date        DateTime
  timeIn      DateTime?
  timeOut     DateTime?
  dayType     DayType  @default(REGULAR)
  hours       Float    @default(0)
  breakTime   Int      @default(0) // minutes
  notes       String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("time_entries")
}

enum DayType {
  REGULAR
  SICK
  VACATION
  PERSONAL
  HOLIDAY
  SNOW_DAY
  PROFESSIONAL_DEVELOPMENT
  BEREAVEMENT
  JURY_DUTY
  UNPAID
}

model TimeOffRequest {
  id            String   @id @default(cuid())
  employeeId    String
  employee      User     @relation(fields: [employeeId], references: [id])
  
  startDate     DateTime
  endDate       DateTime
  type          TimeOffType
  reason        String?
  isHalfDay     Boolean  @default(false)
  halfDayPeriod String? // "AM" or "PM"
  
  status        TimeOffStatus @default(PENDING)
  
  approvedBy    String?
  approver      User?    @relation("ApprovedBy", fields: [approvedBy], references: [id])
  approvedAt    DateTime?
  comments      String?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@map("time_off_requests")
}

enum TimeOffType {
  VACATION
  SICK
  PERSONAL
  BEREAVEMENT
  JURY_DUTY
  MATERNITY
  PATERNITY
  UNPAID
  PROFESSIONAL_DEVELOPMENT
  CONFERENCE
}

enum TimeOffStatus {
  PENDING
  APPROVED
  REJECTED
}

model CalendarEvent {
  id          String   @id @default(cuid())
  title       String
  description String?
  startDate   DateTime
  endDate     DateTime
  type        EventType @default(HOLIDAY)
  building    String?   // null = district-wide
  
  createdBy   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("calendar_events")
}

enum EventType {
  HOLIDAY
  PROFESSIONAL_DEVELOPMENT
  SNOW_DAY
  EARLY_DISMISSAL
  NO_SCHOOL
  CONFERENCE
  MEETING
  DEADLINE
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  
  title     String
  message   String
  type      NotificationType
  relatedId String?
  read      Boolean  @default(false)
  
  createdAt DateTime @default(now())
  
  @@map("notifications")
}

enum NotificationType {
  timecard
  timeoff
  calendar
  system
}

model SystemSettings {
  id    String @id @default(cuid())
  key   String @unique
  value String
  
  updatedAt DateTime @updatedAt
  
  @@map("system_settings")
}
